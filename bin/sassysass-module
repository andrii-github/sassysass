#!/usr/bin/env node

var fs      = require('fs'),
  path      = require('path'),
  prompt    = require('prompt'),
  pkg       = require('../package.json'),
  version   = pkg.version,
  dir       = path.dirname(),
  dateTime  = require('get-date'),
  newFile   = '',
  name,
  overwrite,
  modulePath;

prompt.message = 'SassySass'.magenta;
prompt.delimiter = ' ';

prompt.start();

prompt.get({
  properties: {
    name : {
      description: 'What is the name of the module?'
    },
    modulePath : {
      description: 'Path to modules directory?'
    }
  }
}, function (err, result) {
  name = result.name.replace(/\s+/g, '-');
  modulePath = result.modulePath;
  //console.log('test ' + result.modulePath);
  if(name === ''){
    name = 'module';
  }

  if(modulePath === ''){
    modulePath = 'sass/modules';
  }

  newFile += '// File Name: _' + name + '.scss'+ '\n';
  newFile += '// Description: \n';
  newFile += '// Used by: \n';
  newFile += '// Dependencies: \n';
  newFile += '// Date created: ' + dateTime() + '\n';
  newFile += '// ------------------------------------------------------------ \n';

  // check if file already exists
  fs.exists(dir + '/'+ modulePath +'/_' + name + '.scss', function (exists) {
    if(exists !== true){
      writeFile();
    }else{
      console.log('The module ' + name + ' already exists');
    }
  });

  function writeFile(){
    fs.writeFile(dir + '/'+ modulePath +'/_' + name + '.scss', newFile, function(err) {
      if(err) {
        console.log(err);
        console.log('Directory path might be wrong');
      }else{
        console.log('_' + name + '.scss was created');
      }
      console.log('SassySass module ' + version);
    });
  }
  
});